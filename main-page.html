<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- <link rel="manifest" href="/manifest.json"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="  #000000">
    <meta name="apple-mobile-web-app-status-bar-style" content="  #000000">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Dashboard - Fidelity</title>
    <link rel="stylesheet" href="./css/main-page.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Jacquarda+Bastarda+9&family=Poppins:ital,wght@0,400;1,300;1,400&display=swap" rel="stylesheet">

    
</head>
<body>
    <div id="loader">Hold on dashboard is loading...</div>
    <section class="header">
        <p style="color: rgb(0, 0, 0); font-weight: bold;"><span id="username">Loading...</span></p>
        <a href="profile.html">
            <div class="logo">
            <img src="./images/2606572_5907.jpg" alt="">
        </div>
        </a>
        

    </section>

    <!-- <section class="search">
        <input type="text" class="gradient-border" placeholder="Search...">
    </section> -->

    <div class="balance-container">
        <div class="balance-display">
            <h3>Balance</h3>
            <span id="balance">*****</span>
            <button id="toggleBalance" aria-label="Toggle balance visibility">
                <img src="./images/interface_13741441.png" alt="Toggle Balance" />
            </button>
        </div>
        <div class="button">
            <button id="depositButton">+</button> <!-- Added ID for button -->
        </div>
    </div>

    <section class="functions">
  <div class="functions1" style="display: flex; justify-content: space-around; margin-bottom: 1rem;">
    <div class="tab-button" data-tab="overview" style="cursor: pointer;">Overview</div>
    <a href="invest.html">
        <div class="tab-button" data-tab="transactions" style="cursor: pointer;">Invest</div>
    </a>
    <a href="withdrawal.html">
        <div class="tab-button" data-tab="earn" style="cursor: pointer;">Withdraw</div>
    </a>
  </div>

 
</section>
<div id="overviewContent" class="tab-content">
  <canvas id="investmentChart" style="height: 200px !important; max-height: 200px;"></canvas>

</div>
<div id="transactionsContent" class="tab-content" style="display:none;">
  <p>Loading transactions...</p>
</div>
<div id="earnContent" class="tab-content" style="display:none; font-size: 10px;">
  <p>Earn more by referring users!</p>
</div>

<section id="tab-content">
    
</section>

    <div class="spinner" id="loadingSpinner"></div>
    

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h3>Welcome to Fidelity Investments</h3>
            <p>Invest smartly and grow your wealth with us.</p>
            <a href="invest.html" class="cta-button" id="invest-now-button">Invest now</a><br><br>
            <h3>Our Plans</h3>
            <div class="plans">
                <div class="plan-line1">
                    <div class="plan">
                        <a href="invest.html"><img src="./images/Frame 34.png" alt=""></a>
                        <p>
                            Our Plan A is ideal for investors seeking steady, low-risk growth. With a 20% return on investment (ROI), this plan offers a solid and reliable performance for those who prefer a conservative approach. It’s a great way to begin your investment journey, allowing you to build confidence while minimizing exposure to market fluctuations.
                        </p>
                    </div>
                    <div class="plan">
                        <a href="invest.html">
                            <img src="./images/Frame 35.png" alt="">
                        </a>
                        <p>
                            Plan B: 35% Returns
                            For investors seeking moderate growth with slightly higher returns, Plan B offers a 35% ROI. This plan is balanced, providing an opportunity for enhanced returns without taking on excessive risk. It’s perfect for investors looking to move beyond the conservative approach and aim for better growth potential.
                        </p>
                    </div>
                    <div class="plan">
                        <a href="invest.html">
                            <img src="./images/Frame 36.png" alt="">
                        </a>
                        <p>
                            Plan C: 50% Returns
                            Plan C is for investors ready to engage in higher-reward opportunities, with a 50% ROI. This plan is structured for those who are comfortable with moderate risk and want to experience significant gains. It’s an ideal choice for those seeking to capitalize on market opportunities while still maintaining some level of risk control.
                        </p>
                    </div>
                    <!-- <div class="plan">
                        <a href="invest.html">
                            <img src="./images/Frame 37.png" alt="">
                        </a>
                        <p>
                            Plan D: 100% Returns
                            For the boldest investors, Plan D offers an exceptional 100% ROI, doubling your investment. This plan targets high-return opportunities and is best suited for those with a higher risk tolerance. It’s designed for investors looking to maximize their capital in the shortest time possible, with the understanding that it comes with increased exposure to market fluctuations.
                        </p>
                    </div> -->
                </div>
            </div>
        </div>
    </section>

   

    <!-- Deposit Overlay -->
    <div id="depositOverlay" class="overlay">
        <div class="overlay-content">
            <button id="closeOverlay" class="close-button">X</button>
            <h3>Deposit Options</h3>
            <div class="option" id="buyDollarOption">
                <h3>Buy with local currency</h3>
                <p>Visa, Mastercard, American Express</p>
            </div>
            <div class="option" id="depositCryptoOption">
                <h3>Deposit Crypto</h3>
                <p>Already have crypto? Deposit directly.</p>
            </div>
            <em>
                We recommend that you use a secure and reliable payment method to ensure a smooth transaction.
            </em>
        </div>
    </div>





    
    <!-- <nav class="bottom-nav">
        <ul class="nav-links">
            <li><a href="main-page.html"><img src="./images/Home Page.png"><span>Home</span></a></li>
            <li><a href="chatbot.html"><img src="./images/Chat.png" alt="Services Icon" style=" border-radius: 20rem;"><span>Chat</span></a></li>
            <li><a href="wallet.html"><img src="./images/Wallet.png" alt="About Icon" style="border-radius: 20rem;"><span>Wallet</span></a></li>
            <li><a href="profile.html"><img src="./images/Male User.png" alt="About Icon" style="border-radius: 20rem;"><span>Profile</span></a></li>
            <li><a href="assets.html"><img src="./images/Crypto Trading Options.png" alt="Contact Icon"><span>Assets</span></a></li>
        </ul>
    </nav> -->

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 Fidelity Investments. All rights reserved.</p>
    </footer>
    <script src="https://js.stripe.com/v3/"></script>
<script src="java.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
window.onload = function () {
    document.getElementById("loader").style.display = "none";
    document.querySelector(".container").style.display = "block";
};

document.addEventListener('DOMContentLoaded', () => {
    const userEmail = localStorage.getItem('userEmail');
    const toggleBalanceBtn = document.getElementById('toggleBalance');
    const balanceDisplay = document.getElementById('balance');
    const usernameDisplay = document.getElementById('username');
    let actualBalance;
    const loadingSpinner = document.getElementById('loadingSpinner');

    if (userEmail) {
        fetch('/api/getBalance', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email: userEmail })
        })
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            if (data.success) {
                actualBalance = data.balance;
                balanceDisplay.textContent = actualBalance ? `$${actualBalance}` : 'No balance available';

                if (data.username && usernameDisplay) {
                    usernameDisplay.textContent = data.username;
                }
            } else {
                console.error('User not found:', data.message);
            }
        })
        .catch(error => {
            console.error('Error fetching user data:', error);
        });
    } else {
        console.error('User email not found in local storage');
    }

    toggleBalanceBtn.addEventListener('click', () => {
        balanceDisplay.textContent = (balanceDisplay.innerText === '*****')
            ? (actualBalance ? `$${actualBalance}` : 'No balance available')
            : '*****';
    });

    // Spinner links
    document.getElementById('buyDollarOption').addEventListener('click', () => {
        loadingSpinner.style.display = 'block';
        window.location.href = 'stripe.html';
    });

    document.getElementById('depositCryptoOption').addEventListener('click', () => {
        loadingSpinner.style.display = 'block';
        window.location.href = 'deposit-crypto.html';
    });

    window.addEventListener('load', () => {
        loadingSpinner.style.display = 'none';
    });

    // Overlay logic
    const depositButton = document.getElementById('depositButton');
    const depositOverlay = document.getElementById('depositOverlay');
    const closeOverlayButton = document.getElementById('closeOverlay');

    depositButton.addEventListener('click', () => {
        depositOverlay.classList.add('show');
    });

    closeOverlayButton.addEventListener('click', () => {
        depositOverlay.classList.remove('show');
    });

    // TAB SYSTEM
    const tabContent = document.getElementById('tab-content');
    let chartInstance = null;

    const tabs = {
        overview: async () => {
  try {
    const res = await fetch(`/api/user/history?email=${encodeURIComponent(userEmail)}`);
    const result = await res.json();

    if (!Array.isArray(result.history)) {
      throw new Error("Invalid history format from server");
    }

    const dates = result.history.map(d => new Date(d.date).toLocaleDateString());
    const amounts = result.history.map(d => d.amount);

    tabContent.innerHTML = `
      <div style="padding: 1rem; background: #f5f5f5; border-radius: 8px;">
        <h3>Investment History</h3>
        <canvas id="investmentChart" height="250"></canvas>
      </div>
    `;

    const ctx = document.getElementById('investmentChart').getContext('2d');
    if (chartInstance) chartInstance.destroy();

    chartInstance = new Chart(ctx, {
      type: 'line',
      data: {
        labels: dates,
        datasets: [{
          label: 'Deposits',
          data: amounts,
          borderColor: '#10b981',
          backgroundColor: 'rgba(16,185,129,0.1)',
          fill: true,
          tension: 0.4
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            max: 5000
          }
        }
      }
    });
  } catch (error) {
    tabContent.innerHTML = `<p class="text-red-500">Error loading chart.</p>`;
    console.error('Chart load error:', error);
  }
},



        transactions: async () => {
            try {
                const response = await fetch(`/api/user/transactions?email=${encodeURIComponent(userEmail)}`);
                const data = await response.json();

                const recent = data.slice(0, 5).map(tx => `
                    <li>${new Date(tx.date).toLocaleDateString()} - $${tx.amount} - ${tx.type}</li>
                `).join('');

                tabContent.innerHTML = `
                  <div style="padding: 1rem; background: #eef2ff; border-radius: 8px;">
                    <h3>Recent Transactions</h3>
                    <ul>${recent}</ul>
                  </div>
                `;
            } catch (err) {
                tabContent.innerHTML = `<p>Error fetching transactions.</p>`;
            }
        },

        earn: () => {
            tabContent.innerHTML = `
              <div style="padding: 1rem; background: #d1fae5; border-radius: 8px;">
                <h3>Earn with Referrals</h3>
                <p>Invite friends, get 5% of their first deposit.</p>
                <p>Share your referral link:</p>
                <strong>https://yourapp.com/ref?email=${encodeURIComponent(userEmail)}</strong>
              </div>
            `;
        }
    };

    // Initial load
    tabs.overview();

    // Button events
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.addEventListener('click', () => {
            const tab = btn.getAttribute('data-tab');
            tabs[tab]();
        });
    });
});
</script>


</body>
</html>