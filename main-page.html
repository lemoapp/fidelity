<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- <link rel="manifest" href="/manifest.json"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="  #000000">
    <meta name="apple-mobile-web-app-status-bar-style" content="  #000000">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Dashboard - Fidelity</title>
    <link rel="stylesheet" href="./css/main-page.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Jacquarda+Bastarda+9&family=Poppins:ital,wght@0,400;1,300;1,400&display=swap" rel="stylesheet">

    
</head>
<body>
    <div id="loader">Hold on dashboard is loading...</div>
    <section class="header">
        <p style="color: rgb(0, 0, 0); font-weight: bold;"><span id="username">Loading...</span></p>
        <a href="profile.html">
            <div class="logo">
            <img src="./images/2606572_5907.jpg" alt="">
        </div>
        </a>
        

    </section>

    <!-- <section class="search">
        <input type="text" class="gradient-border" placeholder="Search...">
    </section> -->

    <div class="balance-container">
        <div class="balance-display">
            <h3>Balance</h3>
            <span id="balance">*****</span>
            <button id="toggleBalance" aria-label="Toggle balance visibility">
                <img src="./images/interface_13741441.png" alt="Toggle Balance" />
            </button>
        </div>
        <div class="button">
            <button id="depositButton">+</button> <!-- Added ID for button -->
        </div>
    </div>

    <section class="functions">
  <div class="functions1" style="display: flex; justify-content: space-around; margin-bottom: 1rem;">
    <div class="tab-button" data-tab="overview" style="cursor: pointer;">Overview</div>
    <a href="invest.html">
        <div class="tab-button" data-tab="transactions" style="cursor: pointer;">Invest</div>
    </a>
    <a href="withdrawal.html">
        <div class="tab-button" data-tab="earn" style="cursor: pointer;">Withdraw</div>
    </a>
  </div>
</section>
<div id="chartContainer" style="width: 100%;">
    <canvas id="lineChart" width="100vw" height="1px"></canvas>
</div>


<a href="deposit-crypto.html">
    <div style="margin-top: 1rem; text-align: center;">
      <button style="padding: 0.5rem 1rem; background: #6366f1; color: white; border-radius: 8px;">
        + New Transaction
      </button>
    </div>
</a><br>

    <div id="news-section" style="padding: 0px 10px;">
      <!-- <div class="loader" id="loader" >Loading...</div> -->
      <div id="news-container" class="news-grid"></div>
    </div>  
    <div class="spinner" id="loadingSpinner"></div>
  

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h3>Welcome to Fidelity Investments</h3>
            <p>Invest smartly and grow your wealth with us.</p>
            <a href="invest.html" class="cta-button" id="invest-now-button">Invest now</a><br><br>
            <h3>Our Plans</h3>
            <div class="plans">
                <div class="plan-line1">
                    <div class="plan">
                        <a href="invest.html"><img src="./images/Frame 34.png" alt=""></a>
                        <p>
                            Our Plan A is ideal for investors seeking steady, low-risk growth. With a 20% return on investment (ROI), this plan offers a solid and reliable performance for those who prefer a conservative approach. Itâ€™s a great way to begin your investment journey, allowing you to build confidence while minimizing exposure to market fluctuations.
                        </p>
                    </div>
                    <div class="plan">
                        <a href="invest.html">
                            <img src="./images/Frame 35.png" alt="">
                        </a>
                        <p>
                            Plan B: 35% Returns
                            For investors seeking moderate growth with slightly higher returns, Plan B offers a 35% ROI. This plan is balanced, providing an opportunity for enhanced returns without taking on excessive risk. Itâ€™s perfect for investors looking to move beyond the conservative approach and aim for better growth potential.
                        </p>
                    </div>
                    <div class="plan">
                        <a href="invest.html">
                            <img src="./images/Frame 36.png" alt="">
                        </a>
                        <p>
                            Plan C: 50% Returns
                            Plan C is for investors ready to engage in higher-reward opportunities, with a 50% ROI. This plan is structured for those who are comfortable with moderate risk and want to experience significant gains. Itâ€™s an ideal choice for those seeking to capitalize on market opportunities while still maintaining some level of risk control.
                        </p>
                    </div>
                    <!-- <div class="plan">
                        <a href="invest.html">
                            <img src="./images/Frame 37.png" alt="">
                        </a>
                        <p>
                            Plan D: 100% Returns
                            For the boldest investors, Plan D offers an exceptional 100% ROI, doubling your investment. This plan targets high-return opportunities and is best suited for those with a higher risk tolerance. Itâ€™s designed for investors looking to maximize their capital in the shortest time possible, with the understanding that it comes with increased exposure to market fluctuations.
                        </p>
                    </div> -->
                </div>
            </div>
        </div>
    </section>

   

    <!-- Deposit Overlay -->
    <div id="depositOverlay" class="overlay">
        <div class="overlay-content">
            <button id="closeOverlay" class="close-button">X</button>
            <h3>Deposit Options</h3>
            <div class="option" id="buyDollarOption">
                <h3>Buy with local currency</h3>
                <p>Visa, Mastercard, American Express</p>
            </div>
            <div class="option" id="depositCryptoOption">
                <h3>Deposit Crypto</h3>
                <p>Already have crypto? Deposit directly.</p>
            </div>
            <em>
                We recommend that you use a secure and reliable payment method to ensure a smooth transaction.
            </em>
        </div>
    </div>



    <div class="bottom-nav">
    <a href="user-dashboard.html"><div class="active">Market</div></a>
    <a href="invest.html"><div>Invest</div></a>
    <a href="deposit-crypto.html"><div>Deposit</div></a>
    <a href="assets.html"><div>Assets</div></a>
  </div>
    <footer>
        <p>&copy; 2025 Fidelity Investments. All rights reserved.</p>
    </footer>
    <script src="https://js.stripe.com/v3/"></script>
<script src="java.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
window.onload = function () {
    document.getElementById("loader").style.display = "none";
    document.querySelector(".container").style.display = "block";
};

document.addEventListener('DOMContentLoaded', () => {
    const userEmail = localStorage.getItem('userEmail');
    const toggleBalanceBtn = document.getElementById('toggleBalance');
    const balanceDisplay = document.getElementById('balance');
    const usernameDisplay = document.getElementById('username');
    let actualBalance;
    const loadingSpinner = document.getElementById('loadingSpinner');

    if (userEmail) {
        fetch('/api/getBalance', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email: userEmail })
        })
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            if (data.success) {
                actualBalance = data.balance;
                balanceDisplay.textContent = actualBalance ? `$${actualBalance}` : 'No balance available';

                if (data.username && usernameDisplay) {
                    usernameDisplay.textContent = data.username;
                }
            } else {
                console.error('User not found:', data.message);
            }
        })
        .catch(error => {
            console.error('Error fetching user data:', error);
        });
    } else {
        console.error('User email not found in local storage');
    }

    toggleBalanceBtn.addEventListener('click', () => {
        balanceDisplay.textContent = (balanceDisplay.innerText === '*****')
            ? (actualBalance ? `$${actualBalance}` : 'No balance available')
            : '*****';
    });

    // Spinner links
    document.getElementById('buyDollarOption').addEventListener('click', () => {
        loadingSpinner.style.display = 'block';
        window.location.href = 'stripe.html';
    });

    document.getElementById('depositCryptoOption').addEventListener('click', () => {
        loadingSpinner.style.display = 'block';
        window.location.href = 'deposit-crypto.html';
    });

    window.addEventListener('load', () => {
        loadingSpinner.style.display = 'none';
    });

    // Overlay logic
    const depositButton = document.getElementById('depositButton');
    const depositOverlay = document.getElementById('depositOverlay');
    const closeOverlayButton = document.getElementById('closeOverlay');

    depositButton.addEventListener('click', () => {
        depositOverlay.classList.add('show');
    });

    closeOverlayButton.addEventListener('click', () => {
        depositOverlay.classList.remove('show');
    });

if (userEmail) {
    fetch(`/api/user/history?email=${encodeURIComponent(userEmail)}`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Failed to fetch history: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (!data.history || !Array.isArray(data.history) || data.history.length === 0) {
                console.warn("No deposit history found.");
                return;
            }

            // Create chart wrapper
            const chartWrapper = document.createElement('div');
chartWrapper.style.backgroundColor = '#fff';
chartWrapper.style.borderRadius = '8px';
chartWrapper.style.boxShadow = '0 2px 4px rgba(0,0,0,0.05)';
chartWrapper.style.width = '99%'; // âœ… make wrapper take full width
chartWrapper.style.overflowX = 'auto'; // optional: handles overflow gracefully

// Create canvas element for chart
const canvas = document.createElement('canvas');
canvas.id = 'lineChart';
canvas.style.width = '100%'; // âœ… fill parent div
canvas.style.height = '250px'; // optional: adjust height as needed
canvas.height = 150; // can keep or remove based on how you're sizing

            chartWrapper.appendChild(canvas);

            // âœ… FIX: Use existing element with ID 'chartContainer'
            document.getElementById('chartContainer').appendChild(chartWrapper);

            const ctx = canvas.getContext('2d');

        //    const ctx = document.getElementById('myChart').getContext('2d');

// Create gradient fill
const gradient = ctx.createLinearGradient(0, 0, 0, 400);
gradient.addColorStop(0, 'rgba(16, 185, 129, 0.3)');  // Light green top
gradient.addColorStop(1, 'rgba(16, 185, 129, 0)');    // Transparent bottom

new Chart(ctx, {
  type: 'line',
  data: {
    labels: data.history.map(item => item.date),
    datasets: [{
      data: data.history.map(item => Number(item.amount)),
      borderColor: '#4caf50',
      borderWidth: 2,
      tension: 0.8,                     // ðŸ‘ˆ Smooth wave
      fill: true,                       // ðŸ‘ˆ Enable fill
      backgroundColor: gradient,        // ðŸ‘ˆ Use gradient
      pointRadius: 0,                   // ðŸ‘ˆ Hide dots for cleaner look
      pointHoverRadius: 4,
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false },
      tooltip: { enabled: true }
    },
    scales: {
     x: {
  display: false,
  ticks: {
    color: '#ccc',       // Light gray text
    font: {
      size: 8            // Very small font
    },
    maxRotation: 0,       // Prevent label rotation
    autoSkip: true        // Auto skip labels to prevent clutter
  },
  title: {
    display: false
  },
  grid: {
    display: false        // Optional: remove vertical grid lines
  }
},

      y: {
  display: true,
  ticks: {
    color: '#ccc',      // ðŸ”… light gray to blend in
    font: {
      size: 8           // ðŸ§ very small text
    }
  },
  title: {
    display: false
  },
  grid: {
    display: false // âŒ disables horizontal grid lines
  }
}

    },
    spanGaps: true
  }
});

        })
        .catch(error => {
            console.error('Error loading chart data:', error);
        });
} else {
    console.error('User email not found in local storage (chart)');
}

});

const buttons = document.querySelectorAll('.category-buttons button');
const loader = document.getElementById('loader');
const newsContainer = document.getElementById('news-container');

const API_BASE = '/api/news'; // adjust if using full domain

async function fetchNews(category) {
  loader.style.display = 'block';
  newsContainer.innerHTML = '';

  try {
    const res = await fetch(`${API_BASE}?category=${category}`);
    const data = await res.json();

    loader.style.display = 'none';

    if (!data.news || data.news.length === 0) {
      newsContainer.innerHTML = `<p>No news available for ${category} yet.</p>`;
      return;
    }

    // âœ… Limit to 6 news items
    data.news.slice(0, 6).forEach(article => {
      const card = document.createElement('div');
      card.className = 'news-card';

      card.innerHTML = `
        ${article.image ? `<img src="${article.image}" alt="News Image" />` : ''}
        <div class="news-content">
          <div class="news-title">${article.title}</div>
          <div class="news-meta">
            ${article.source || 'Unknown source'} â€¢ 
            ${new Date(article.published_at).toLocaleDateString()}
          </div>
          <a href="${article.url}" target="_blank" class="news-link">Read more</a>
        </div>
      `;

      newsContainer.appendChild(card);
    });

  } catch (err) {
    loader.style.display = 'none';
    newsContainer.innerHTML = `<p>Error fetching news. Please try again later.</p>`;
    console.error(err);
  }
}

buttons.forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelector('.category-buttons button.active')?.classList.remove('active');
    btn.classList.add('active');
    const category = btn.getAttribute('data-category');
    fetchNews(category);
  });
});

// Load default category
fetchNews('crypto');

</script>



</body>
</html>